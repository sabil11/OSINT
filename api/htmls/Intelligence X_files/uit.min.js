/*!
Copyright (c) 2017-2018 Kleissner Investments s.r.o.
Unauthorized copying or usage of this file, via any medium is strictly prohibited Proprietary and confidential.
*/const ENTITY_MAP={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},MONTH_NAMES=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],TEXT_401="Your IP or API key is not authorized. Please contact support.",TEXT_402="Your IP or API key has exceeded the allowed limit. If you believe this is an error, please contact support.<br>Protip: Professional accounts have higher daily limits!";const GET_URL_PARAMETER=function(sParam){var sPageURL=window.location.search.substring(1),sURLVariables=sPageURL.split("&"),sParameterName,sParameterValue;for(var i=0;i<sURLVariables.length;i++){sParameterName=sURLVariables[i].split("=");if(sParameterName[0]===sParam){sParameterValue=sURLVariables[i].substring(sURLVariables[i].indexOf('=')+1)
return sParameterValue===undefined?true:decodeURIComponent(sParameterValue);}}};const SIX_MONTHS_AGO=function(){var now=new Date();now.setDate(now.getDate()+7);now.setMonth(now.getMonth()-6);return now;};const ONE_YEAR_AGO=function(){now=new Date();now.setDate(now.getDate()+7);now.setYear(now.getFullYear()-1);now.setMonth(now.getMonth());return now;};var SETTING_EXPORT_LIMIT=!!localStorage.getItem("exportlimit_setting")?localStorage.getItem("exportlimit_setting"):1000,SETTING_HEATMAP=!!localStorage.getItem("heatmap_setting")?localStorage.getItem("heatmap_setting"):0,SETTING_MAX_RESULT=!!localStorage.getItem("maxresults_setting")?localStorage.getItem("maxresults_setting"):1000,SETTING_MAX_RESULT_PB=!!localStorage.getItem("maxresults_settingPB")?localStorage.getItem("maxresults_settingPB"):4000,SETTING_MAX_SELECTOR_LIMIT=!!localStorage.getItem("maxselectors_setting")?localStorage.getItem("maxselectors_setting"):2000,SETTING_PREVIEW_LINES=!!localStorage.getItem("preview_lines_setting")?localStorage.getItem("preview_lines_setting"):8,SETTING_SPLASH_SCREEN=!!localStorage.getItem("splash_setting")?localStorage.getItem("splash_setting"):0,SETTING_SPLASH_TIME=!!localStorage.getItem("splash_time_setting")?localStorage.getItem("splash_time_setting"):500;var aborted=false,cal,currentHistoryIndex,currentSearchId,currentSearchIdPB,detailsData=[],detailsPrint=[],detailsSearchArr=[],detailsSearchIndex=[],detailsSearchSubIndex=[],detailsSearchValue=[],edges,foundRes=0,foundResPB=0,heatmapData=[],inProgress,initialSearch=true,iscr,isOverServices=false,isSearching=false,lastSearchIDs=[],limit=10,limitPB,monthNamesUsed=[],nodes,relArr=[],search2,search2PB,searchRes=0,searchResArr=[],srcStr,terms=undefined,txttypetimer,typer,ultimateArray,windowWidth=$(window).width(),xhr;var calOptions={domain:"week",subDomain:"day",cellSize:10,label:{position:"bottom"},range:52,start:ONE_YEAR_AGO(),cellPadding:2,domainGutter:1,cellRadius:0,displayLegend:true,tooltip:true,domainLabelFormat:function(date,nb){monthNamesUsed.push(MONTH_NAMES[date.getMonth()]);if(countInArray(monthNamesUsed,MONTH_NAMES[date.getMonth()])==3&&MONTH_NAMES[date.getMonth()]!=monthNamesUsed[0]){var today=new Date(date);return MONTH_NAMES[date.getMonth()]+" "+today.getFullYear().toString().substr(-2);}else{return "";}},animationDuration:0,onClick:function(date,nb){},legend:[2,5,10,20],legendVerticalPosition:"center",legendOrientation:"vertical",legendMargin:[0,10,0,0],previousSelector:"#ftr-demo-previous",nextSelector:"#ftr-demo-next",itemName:["document","documents"],maxDate:new Date(),data:API_URL+"intelligent/search/statistic?id="+currentSearchId,afterLoadData:function(data){return data.heatmap;}};/*!
Copyright (c) 2017 Kleissner Investments s.r.o.
Unauthorized copying or usage of this file, via any medium is strictly prohibited Proprietary and confidential.
*/function charAt(string,index){var first=string.charCodeAt(index);var second;if(first>=0xD800&&first<=0xDBFF&&string.length>index+1){second=string.charCodeAt(index+1);if(second>=0xDC00&&second<=0xDFFF){return string.substring(index,index+2);}}
return string[index];}
function compare(a,b){if(a.info<b.info){return-1;}
if(a.info>b.info){return 1;}
return 0;}
function countInArray(array,what){var count=0;for(var i=0;i<array.length;i++){if(array[i]===what){count++;}}
return count;}
function dateConvert(date){return date.substring(0,4)+"-"+date.substring(5,7)+"-"+date.substring(8,10)+" "+date.substring(11,19);}
function dateConvert2(date){return date.substring(0,4)+"-"+date.substring(5,7)+"-"+date.substring(8,10);}
function detailFormatter2(index,row){var html=['<div id="'+index+'" class="searchDataContainer raw" style="margin-bottom: 0px;margin-top:0px;">'];$.each(row,function(key,value){if(key!="date"&&key!="systemid"){return;}
if(key=="systemid"){key="System ID";var previewCommand="f=4&systemid="+value+"&lines=8";$.ajax({url:API_URL+"file/view",type:"GET",cache:true,data:previewCommand,success:function(data,textStatus,xhr){if(!!data){srcStr=data;html.push($("#details_"+index).css("padding","0px"));html.push($("#details_"+index).html(""));html.push($("#details_"+index).prepend('<pre '+
'class="pre-details" '+
'style="'+
'border: 0px;'+
'outline: none;'+
'background: white;'+
'margin-bottom: 0px;'+
'overflow: auto;'+
'overflow-y: hidden;'+
'"'+
'>'+
srcStr+
'</pre>'));}},error:function(data,textStatus,xhr){html.push($("#details_"+index).css("padding","0px"));html.push($("#details_"+index).html(""));html.push($("#details_"+index).prepend('<pre '+
'class="pre-details" '+
'style="'+
'border: 0px;'+
'outline: none;'+
'background: white;'+
'margin-bottom: 0px;'+
'overflow: auto;'+
'overflow-y: hidden;'+
'"'+
'>'+
'No Data'+
'</pre>'));}});}});html.push("</div><div id='details_"+index+"' style='display:block;' class='col-xs-12'></div>");return html.join("");}
function escapeHtml(string){return String(string).replace(/[&<>"'`=\/]/g,function(s){return ENTITY_MAP[s];});}
function isValidEmailAddress(emailAddress){var pattern=/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;return pattern.test(emailAddress);}
function round5(x){return x%5>=2.5?parseInt(x/5)*5+5:parseInt(x/5)*5;}
function showDataInView(element,data,pxPerline,searchArr,row,pos,value){var index=Math.floor($(element).scrollTop()/pxPerline)-20;var max=Math.ceil(($(element).scrollTop()+$(element).height())/pxPerline)+20;var html="";for(index;index<max;index++){if(!!data[index]){var line=data[index];if(!!value){for(var i=0;i<searchArr.length;i++){if(searchArr[i].index==index){var positions=searchArr[i].positions;line=data[index].substring(0,positions[0]);for(var j=0;j<positions.length;j++){if(i==row&&j==pos){line+='<span class="highlighted selected">'+data[index].substring(positions[j],positions[j]+value.length)+'</span>';}else{line+='<span class="selected">'+data[index].substring(positions[j],positions[j]+value.length)+'</span>';}
line+=data[index].substring(positions[j]+value.length,positions[j+1]);}}}}
html+='<div class="detailLine" data-index="'+index+'" style="top: '+pxPerline*index+'px;height:'+pxPerline+'px;">'+line+'</div>';}}
return html;}
function slice(string,start,end){var accumulator="";var character;var stringIndex=0;var unicodeIndex=0;var length=string.length;while(stringIndex<length){character=charAt(string,stringIndex);if(unicodeIndex>=start&&unicodeIndex<end){accumulator+=character;}
stringIndex+=character.length;unicodeIndex+=1;}
return accumulator;}
function toNumber(value,fallback){if(!value){return fallback;}else{return Number(value);}}
function unicodeSubstring(string,start,end){var realStart=toNumber(start,0);var realEnd=toNumber(end,string.length);if(realEnd==realStart){return "";}else if(realEnd>realStart){return slice(string,realStart,realEnd);}else{return slice(string,realEnd,realStart);}}
function uuid(){var uuid="",i,random;for(i=0;i<32;i++){random=(Math.random()*16)|0;if(i==8||i==12||i==16||i==20){uuid+="-";}
uuid+=(i==12?4:i==16?(random&3)|8:random).toString(16);}
return uuid;}
'use strict';var kleissner=kleissner||{};kleissner.apiCalls=(function($){const uiHelper=typeof uiToolkitType!=='undefined'?uiToolkitType:false;const lim=uiHelper=='pandora'?"&l="+SETTING_MAX_SELECTOR_LIMIT:"";var
searchAPIGet,searchAPIPost,checkResultsPB,getSearchIdPB,getSelectorList,getViewDetails,loadRawData,checkResults,getDetails,getSearchId,getAuthenticateInfo,init;searchAPIGet=function searchAPIGet(command,params,successF,errorF,beforeSend){xhr=$.ajax({url:API_URL+command,headers:{'x-key':API_KEY},type:'GET',cache:true,data:params,success:successF,error:errorF,xhr:beforeSend});};searchAPIPost=function searchAPIPost(command,params,successF,errorF){xhr=$.ajax({url:API_URL+command,headers:{'x-key':API_KEY},type:'POST',cache:true,data:params,success:successF,error:errorF});};checkResultsPB=function checkResultsPB(pl_ID,searchTerm,limit){if(!aborted){if(pl_ID!=currentSearchIdPB){return;}
var command="id="+pl_ID+"&limit="+limit;searchAPIGet("phonebook/search/result",command,function(data,textStatus,xhr){if(data.status==3){if(searchRes<1){if(!uiHelper){$("#spinner").show();$('.delme.error').html('Searching for more Phonebook results...').show();$('#services_container').show();kleissner.frontendChanges.autoTogglePBButton();}}
setTimeout(function(){checkResultsPB(pl_ID,searchTerm,limit);},500);}else{var selectors=data.selectors;if(!!selectors){$("#loading").hide();$('#download_all_PB').show();kleissner.frontendChanges.appendSearchResultPB(selectors,searchTerm);if(!uiHelper){kleissner.frontendChanges.autoTogglePBButton();}
if(selectors.length<limit&&selectors.length>0){setTimeout(function(){limit=limit-selectors.length;checkResultsPB(pl_ID,searchTerm,limit);},500);}else{if(!uiHelper&&selectors.length===0){if(searchRes<1){kleissner.frontendChanges.changeSearchMessagePB('No results found.');}}
search2PB.data("requestRunning",false);var anchor=$("#showMore").closest(".div");if(anchor.prevObject["0"]){anchor.prevObject["0"].remove();}
$("#tabPB").attr("search-id",pl_ID).attr("search-term",searchTerm);if(uiHelper=='pandora'){kleissner.frontendChanges.toggleSpinner(false);}}}}},kleissner.frontendChanges.onResultsErrorPB(pl_ID));}};getSearchIdPB=function getSearchIdPB(formData,searchTermPB){$('#adv_search').hide();$('.delme').not('.error').remove();if(!uiHelper){kleissner.frontendChanges.changeSearchMessagePB();}
var buckets=formData.targetservice;$("#active_buckets_warning").html("");if(typeof buckets!=="undefined"){if(buckets.length>0){$("#active_buckets_warning").html("Filter Active");}}
formData={term:searchTermPB,buckets:buckets,maxresults:Number(SETTING_MAX_RESULT_PB),timeout:Number(formData.timeout),media:Number(formData.mediaFilter),terminate:lastSearchIDs,target:Number(formData.pb_target)};search2PB=$(this);search2PB.data("requestRunning",true);var start_time=new Date().getTime();if(uiHelper=='pandora'){kleissner.frontendChanges.toggleSpinner(true);}
if(uiHelper=='pandora'){lastSearchIDs=[];}
searchAPIPost("phonebook/search",JSON.stringify(formData),function(p,statusText,xhr){limitPB=Number(SETTING_MAX_RESULT_PB);searchRes=0;foundResPB=0;lastSearchIDs.push(p.id);currentSearchIdPB=p.id;checkResultsPB(p.id,searchTermPB,limitPB);var data_emails=[];var data_domains=[];var data_urls=[];ultimateArray=[];$("#searchfor").val("");if(uiHelper=='pandora'){$("#download_all").attr("href",API_URL+
"phonebook/search/export?id="+p.id+
"&l="+Number(SETTING_EXPORT_LIMIT)).attr("data-original-title","Export CSV");$("#download_all_zip").hide();}else if(!uiHelper){$('#download_all_PB').attr("href",API_URL+
"phonebook/search/export?id="+p.id+
"&l="+Number(SETTING_EXPORT_LIMIT)+
"&k="+API_KEY).attr("data-original-title","Export CSV");}
$("#export_wrapper").show();$("#print_pb").show();},!uiHelper?function(xhr,status,error){if(xhr.status==401){xhr.responseText=TEXT_401;}else if(xhr.status==402){xhr.responseText=TEXT_402;}
$('.delme').not('.error').remove();kleissner.frontendChanges.changeSearchMessagePB(xhr.responseText);$('#services_container').show();kleissner.frontendChanges.autoTogglePBButton();}:null);};getSelectorList=function getSelectorList(systemid,bucket,obj,$el){var command;if(!!bucket){command="id="+systemid+"&bucket="+bucket+"&k="+API_KEY+lim;}else{command="id="+systemid+"&k="+API_KEY;}
var sel_id_data=[];var sel_id_stats=[];var table=$el.find('.sel_id_table');table.bootstrapTable({data:sel_id_data});table.bootstrapTable('updateFormatText','NoMatches','Loading selectors...');searchAPIGet("item/selector/list/human",command,function(p,textStatus,xhr){if(!!p){$(p.selectors).each(function(i,v){var b={selector:v.selectorh,typeh:v.typeh,type:v.type};sel_id_data.push(b);});$(p.statistic).each(function(i,v){var c=v.count+" "+v.typeh;sel_id_stats.push(c);});if(!!sel_id_data){table.removeClass('empty');}else{table.addClass('empty');}
table.bootstrapTable("load",{data:sel_id_data});var href=API_URL+"item/selector/list/export"+
"?id="+systemid+
"&bucket="+bucket+
"&k="+API_KEY;$el.find(".dl_sel_list").attr("href",href);$el.show();}
var jobCount=p.selectors.length;var total_visible="Showing "+p.count+" out of "+jobCount+" Total";sel_id_stats=sel_id_stats.join(", ");$el.find(".counter").text(total_visible);$el.find(".counter2").text(" ("+sel_id_stats+").");},function(xhr,status,error){$el.find(".counter").text('');$el.find(".counter2").text('');if(xhr.status==401){if(API_LEVEL=='public'){table.bootstrapTable('updateFormatText','NoMatches','Insufficient access rights. Sign up <a href="/.signup" target="_blank">here</a>.');}else{table.bootstrapTable('updateFormatText','NoMatches','Insufficient access rights. Upgrade <a href="./order" target="_blank">here</a>.');}}else{table.bootstrapTable('updateFormatText','NoMatches','No matching records found');}});};getViewDetails=function getViewDetails(id){var p=uiHelper=='pandora'?searchResArr[$('.tab_row_item.selected').attr('data-id')][id]:searchResArr[id];if(typeof p!='undefined'&&'inline'in p&&!!p['inline']){p=p['inline'];}
if(!!p){var type;var saveFile=$("#save_file");var redactedWarning=$("#redactedwarning");if(p.accesslevel==4){if(API_LEVEL.indexOf("public")!=-1){redactedWarning.html('<div class="alert alert-info" role="alert">'+
'<a href="./signup" target="_blank">Signup</a> '+
'or '+
'<a href="#" data-toggle="modal" data-target="#loginModal" id="redacted_login">Login</a> '+
'to view redacted documents.'+
'</div>');}else{redactedWarning.html('<div class="alert alert-info" role="alert">'+
'<a href="./order" target="_blank">Upgrade</a> your License to view redacted documents.'+
(p.bucket.startsWith("leaks.private")?' The "Private Leaks" category is only available to paid users.':'')+
'</div>');}
redactedWarning.show();}else{redactedWarning.html('');}
if(p.type==2){type=3;}else{type=0;}
if(!p.name){p.name="Untitled Document";}
detailsPrint=p;kleissner.apiCalls.loadRawData(type,p.storageid,p.bucket,p.systemid,p.media,p.accesslevel,p.size,p.indexfile,p.historyfile);if(p.type<1000){saveFile.show();}
if(p.accesslevel==4){saveFile.attr('class','disabled');saveFile.click(function(){return false;})}
$("#systemid").html("").append(p.systemid);$('#data_selector').off('click').on('click',function(){kleissner.apiCalls.getSelectorList(p.systemid,p.bucket,$('.data_tab.active'),$('#inline_sel_id_overlay'));$(this).off('click');});$("#added").html("").append(dateConvert(p.added));$("#main_date").html("").append(dateConvert(p.date));$("#date").html("").append(dateConvert(p.date));$("#description").html("").append(p.description);$("#name").html("").append(p.name);$("#main_name").html("").append(p.name);$("#size").html("").append(p.size+' Bytes');$("#simhash").html("").append(p.simhashh);$("#storageid").html("").append(p.storageid);$("#type").html("").append(p.typeh);$("#media").html("").append(p.mediah);$("#category").html("").append(p.bucketh);if(p.accesslevel==5){$('#declassDiv').show();}
var kv_all="";var kv_i=0;if(!!p.keyvalues&&p.keyvalues.length>0){kv_all+='<tbody>';$.each(p.keyvalues,function(key,val){kv_all+='<tr><td>'+val.key+'</td><td>'+val.value+'</td></tr>';});kv_all+='</tbody>';}
$("#keyvalues").html("").append(kv_all);var tg_all=[];var tg_i=0;$.each(p.tagsh,function(key,val){tg_all+="<p class='col-xs-3 nopadding'>"+
val.classh+
"</p>"+
"<p class='col-xs-9 nopadding>"+
val.valueh+
"</p>";});var rel_arr=[];var parents;var translations;var links;var children;var count_children=1;if(p.children){if(p.children.length>1){children=""+p.children.length+" Children</a>";}else{children="1 Child";}
$.each(p.children,function(key,val){count_children++;if(count_children<=10){var n={id:count_children,label:val,size:30,borderWidth:2,borderWidthSelected:0,fixed:true,group:"source",level:2};nodes.push(n);var e={from:count_children,to:1,length:10,physics:false};edges.push(e);}});}
if(!!p.links){if(p.links.length>1){links=""+p.links.length+" Links</a>";}else{links="1 Link";}
var count_links=nodes.length;$.each(p.links,function(key,val){count_links++;if(count_links<=10){var n={id:count_links,label:val,size:30,borderWidth:2,borderWidthSelected:0,fixed:true,group:"link",level:2};nodes.push(n);var e={from:count_links,to:1,length:10,physics:false};edges.push(e);}});}
if(!!p.parents){if(p.parents.length>1){parents=""+p.parents.length+" Parents</a>";}else{parents="1 Parent";}
var count_parents=nodes.length;$.each(p.parents,function(key,val){count_parents++;if(count_parents<=10){var n={id:count_parents,label:val,size:30,borderWidth:2,borderWidthSelected:0,fixed:true,group:"source",level:0};nodes.push(n);var e={from:count_parents,to:1,length:10,physics:false};edges.push(e);}});}
if(!!p.translations){if(p.translations.length>1){translations=""+p.translations.length+" Translations</a>";}else{translations="1 Translation";}
var count_translations=nodes.length;$.each(p.translations,function(key,val){count_translations++;if(count_translations<=10){var n={id:count_translations,label:val,size:30,borderWidth:2,borderWidthSelected:0,fixed:true,group:"source",level:2};nodes.push(n);var e={from:count_translations,to:1,length:10,physics:false};edges.push(e);}});}
$("table").find("tbody").find("tr").has("td:empty").hide();saveFile.attr("href",API_URL+"file/read?type=1&systemid="+p.systemid+"&k="+API_KEY);if(!!p['simhashh']){$('#similar_link').html('').append('<a href="./?s='+p['simhashh']+'" target="_blank"><i class="fa fa-search"></i> Find Similar</a>');}else{$('#similar_link').html('').append('<span class="invalidLink">Find Similar</span>');}
$('#contentRemoval').attr("href","/abuse?did="+p.systemid);}};loadRawData=function loadRawData(type,storageid,bucket,systemid,media,accesslevel,size,indexFile,historyFile){var dataFull=$('#data_full');dataFull.show();var command="";var tab=$('li.data_tab[data-tab="data_full_tab"]');$('li.data_tab[data-tab="data_special_tab"]').remove();$('#data_special_tab').remove();$('li.data_tab[data-tab="data_index_tab"]').remove();$('#data_index_tab').remove();$('li.data_tab[data-tab="data_history_tab"]').remove();$('#data_history_tab').remove();tab.html('<i class="fa fa fa-file-o"></i> Document');if(type!=3){var getText=function getText(){var f;switch(media){case 9:f=7;break;case 15:f=6;break;case 16:f=8;break;case 17:f=9;break;case 18:f=10;break;case 23:f=7;break;case 25:f=11;break;default:f=0;}
command="f="+f+"&storageid="+storageid+"&bucket="+bucket+"&k="+API_KEY+"&license="+API_LEVEL;kleissner.apiCalls.searchAPIGet("file/view",command,function(p,textStatus,xhr){if(!!p){if(media!=9&&media!=23){detailsPrint['raw']=p;}
$('#close-detail-view').attr('data-storageid',storageid);detailsData[storageid]=p.split('\n');dataFull.html('<h4 class="hidden_no_print" style="margin-top:0px;">Raw File</h4>'+
'<div style="height: '+20*detailsData[storageid].length+'px">'+
showDataInView("#data_full",detailsData[storageid],20,detailsSearchArr[storageid],detailsSearchIndex[storageid],detailsSearchSubIndex[storageid],detailsSearchValue[storageid])+
'</div>'+
'<h5 class="hidden_no_print" style="margin-top:50px;">'+
'<hr>'+
'Disclaimer: Intelligence X finds information in public electronic records. '+
'It does not validate or vet any of the above information.'+
'</h5>');dataFull.on('scroll',{id:storageid},kleissner.eventHandler.detailedViewOnScroll);$('#dataFullSearch').off('keyup').on('keyup',{id:storageid},kleissner.eventHandler.dataSearchOnKeyUp).show();$('#printReport').off('click').on('click',{id:storageid},kleissner.localHandler.printOnClick);}else{dataFull.html('');}},function(XMLHttpRequest,textStatus,errorThrown){dataFull.html("");if(XMLHttpRequest.status=="402"){dataFull.append(TEXT_402);}else if(XMLHttpRequest.status=="401"){dataFull.append(TEXT_401);}else{dataFull.hide();}},function(){var xhr=new window.XMLHttpRequest();$('#data_full').html('<div style="display:flex; flex-direction: column; align-items: center; justify-content: center; margin-top: 230px;font-size: 1.5rem;"><div id="loadingBarPercentage">0%</div><div style="padding: 3px; border: 2px solid black;"><div id="loadingBar" style="position:relative; width: 200px; height: 15px; background-color:gray; overflow: hidden;"><div id="loadedBlock" style="position: relative; width: 200px; height: 15px; background-color: black; left: -200px;"></div></div></div></div>')
xhr.addEventListener("progress",function(evt){var percentComplete=evt.loaded/size;var display=percentComplete<=1?Math.floor(percentComplete*100):100;$('#loadingBarPercentage').html(display+'%');$('#loadedBlock').css('left',display/100*200-200+'px');},false);return xhr;});};if(media==9||media==23||media==15||media==16||media==17||media==18||media==25){var specialTab=$('<div id="data_special_tab" class="data_content"></div>');$('#data_full_tab').before(specialTab);tab.html('<i class="fa fa-file-text-o"></i> Text-only');if(media==16||media==17||media==18||media==25){getText();}else{tab.removeClass('active');var newTab=$('<li class="data_tab active" data-tab="data_special_tab"><i class="fa fa-file-o"></i> Document</li>');tab.before(newTab);tab.on('click',function tabClick(){tab.off('click',tabClick);getText();});newTab.click();}}else if(media==2){tab.hide();$('.data_tab[data-tab="tech_data_tab"]').click();}else{getText();tab.show();}
if(media==9||media==23){command=API_URL+"file/view?f=5&storageid="+storageid+"&bucket="+bucket+"&k="+API_KEY+"&license="+API_LEVEL;detailsPrint['iframe']=true;detailsPrint['raw']=command;var frame=$('<iframe src="'+command+'"></iframe>');specialTab.append(frame);}else if(media==15){if(accesslevel==4){if(API_LEVEL=='public'){specialTab.append('<div>Insufficient access rights. <a href="./signup" target="_blank">Signup</a> or <a href="#" data-toggle="modal" data-target="#loginModal" id="redacted_login">Login</a> to view this PDF document.</div>');}else{specialTab.append('<div>Insufficient access rights. Upgrade <a href="./order" target="_blank">here</a>.</div>');}}else{command=API_URL+"file/read?type=1&storageid="+storageid+"&bucket="+bucket+"&k="+API_KEY;var frame=$('<iframe src="/assets/js/libraries/PDFJS/web/viewer.html?file='+encodeURIComponent(command)+'"></iframe>');specialTab.append(frame);}}}else{dataFull.html('');detailsPrint['raw']='<img src="'+API_URL+"file/view?f=3&storageid="+storageid+"&bucket="+bucket+'&k='+API_KEY+'">';dataFull.html("<h4 class='hidden_no_print'>Raw File</h4>").append('<img src="'+API_URL+"file/view?f=3&storageid="+storageid+"&bucket="+bucket+'&k='+API_KEY+'">').append('<h5 '+
'class="hidden_no_print" '+
'style="margin-top:50px;">'+
'<hr>'+
'Disclaimer: Intelligence X finds information in public electronic records. '+
'It does not validate or vet any of the above information.'+
'</h5>');}
if(!!indexFile){var indexTab=$('<div id="data_index_tab" class="data_content"></div>');$('#data_full_tab').after(indexTab);var treeViewTab=$('<li class="data_tab" data-tab="data_index_tab"><i class="fa fa-folder-open-o"></i> Tree View</li>');tab.after(treeViewTab);treeViewTab.on('click',function treeViewTabClick(){treeViewTab.off('click',treeViewTabClick);kleissner.apiCalls.searchAPIGet('file/view','f=12&storageid='+indexFile+'&bucket='+bucket+'&k='+API_KEY+'&license='+API_LEVEL,function(p,textStatus,xhr){indexTab.html('<pre>'+p+'</pre>');},function(XMLHttpRequest,textStatus,errorThrown){indexTab.html("");if(XMLHttpRequest.status=="402"){indexTab.append(TEXT_402);}else if(XMLHttpRequest.status=="401"){indexTab.append(TEXT_401);}else{indexTab.append('Error getting Tree View, try again later.');}},function(){var xhr=new window.XMLHttpRequest();$('#data_index_tab').html('<pre><div style="display:flex; flex-direction: column; align-items: center; justify-content: center; margin-top: 230px;font-size: 1.5rem;"><div id="loadingBarPercentage">0%</div><div style="padding: 3px; border: 2px solid black;"><div id="loadingBar" style="position:relative; width: 200px; height: 15px; background-color:gray; overflow: hidden;"><div id="loadedBlock" style="position: relative; width: 200px; height: 15px; background-color: black; left: -200px;"></div></div></div></div></pre>')
xhr.addEventListener("progress",function(evt){var percentComplete=evt.loaded/size;var display=percentComplete<=1?Math.floor(percentComplete*100):100;$('#loadingBarPercentage').html(display+'%');$('#loadedBlock').css('left',display/100*200-200+'px');},false);return xhr;});indexTab.html()});}
if(!!historyFile){var indexTab2=$('<div id="data_history_tab" class="data_content"></div>');$('#data_full_tab').after(indexTab2);var historyTab=$('<li class="data_tab" data-tab="data_history_tab"><i class="fa fa-history"></i> History</li>');tab.after(historyTab);historyTab.on('click',function historyTabClick(){historyTab.off('click',historyTabClick);kleissner.apiCalls.searchAPIGet('file/view','f=12&storageid='+historyFile+'&bucket='+bucket+'&k='+API_KEY+'&license='+API_LEVEL,function(p,textStatus,xhr){indexTab2.html('<pre>'+p+'</pre>');},function(XMLHttpRequest,textStatus,errorThrown){indexTab2.html("");if(XMLHttpRequest.status=="402"){indexTab2.append(TEXT_402);}else if(XMLHttpRequest.status=="401"){indexTab2.append(TEXT_401);}else{indexTab2.append('Error getting history, try again later.');}},function(){var xhr=new window.XMLHttpRequest();$('#data_history_tab').html('<pre><div style="display:flex; flex-direction: column; align-items: center; justify-content: center; margin-top: 230px;font-size: 1.5rem;"><div id="loadingBarPercentage3">0%</div><div style="padding: 3px; border: 2px solid black;"><div id="loadingBar" style="position:relative; width: 200px; height: 15px; background-color:gray; overflow: hidden;"><div id="loadedBlock3" style="position: relative; width: 200px; height: 15px; background-color: black; left: -200px;"></div></div></div></div></pre>')
xhr.addEventListener("progress",function(evt){var percentComplete=evt.loaded/size;var display=percentComplete<=1?Math.floor(percentComplete*100):100;$('#loadingBarPercentage3').html(display+'%');$('#loadedBlock3').css('left',display/100*200-200+'px');},false);return xhr;});indexTab2.html()});}
$('#detail_overlay').modal();$('.fa.fa-print').off('click').on('click',{id:storageid},kleissner.localHandler.printOnClick);};checkResults=function checkResults(pl_ID,searchTerm,limit,groupUp,altterm,alttermh,statistics=1,bucket,media,dateFrom,dateTo,reset,callback){if(!aborted){var tab;if(!uiHelper){if(pl_ID!=currentSearchId){return;}
kleissner.frontendChanges.toggleHeader(false);tab=$('#tab');tab.attr("search-id",pl_ID).attr("search-term",searchTerm).attr("groupUp",groupUp).attr("alt-term",altterm).attr("alt-termh",alttermh);}else if(uiHelper=='pandora'){searchResArr[pl_ID]=[]
var tabwrapper=$('#tab_wrapper');if($('.tab[search-id="'+pl_ID+'"]').length<=0){$('.tab').removeClass('selected');tab=$('<div class="tab selected"></div>');tabwrapper.append(tab);tab.attr("search-id",pl_ID).attr("search-term",searchTerm);}else{tab=$('.tab[search-id="'+pl_ID+'"]');}}
var command="id="+pl_ID+
"&limit="+limit+
"&statistics="+statistics+
"&previewlines="+SETTING_PREVIEW_LINES;command+=!!bucket?'&bucket='+bucket:'';command+=!!media?'&media='+media:'';command+=!!dateFrom&&!!dateTo?'&from='+dateFrom+' 00:00:00&to='+dateTo+' 23:59:59':'';command+=!!reset||reset===0?'&reset='+reset:'';searchAPIGet("intelligent/search/result",command,function(data,textStatus,xhr){isSearching=true;if(data.status==3){iscr=1;if(uiHelper=='pandora'){tab.html("<div "+
"style='position: relative;width: 100%;text-align: center;height: 20px;z-index: -1;' "+
">"+
"Searching for more results ..."+
"</div>");}else if(!uiHelper){$("#spinner").show();kleissner.frontendChanges.changeSearchMessage('Searching for more results ...',20);}
setTimeout(function(){checkResults(pl_ID,searchTerm,limit,groupUp,altterm,alttermh,0,null,null,null,null,null,callback);},2000);}else{if(!!data){iscr=0;if(uiHelper=='pandora'){$("#loading").hide();kleissner.frontendChanges.toggleHeatmapStats(true);}
kleissner.frontendChanges.appendSearchResult(pl_ID,data,searchTerm,groupUp,statistics,callback);if(data.status==1||data.status==2){if(data.status==2){if(uiHelper=='pandora'){$("#nmr").remove();tab.append("<div style='margin-top: 0px;' id='nmr'>Search session expired. Please start a new search.</div>");kleissner.frontendChanges.toggleHeatmapStats(false);kleissner.frontendChanges.toggleDownloadSorter(false);}else if(!uiHelper){kleissner.frontendChanges.changeSearchMessage('Search session expired. Please start a new search.',80);isSearching=false;}
kleissner.frontendChanges.toggleDownload(false);}else if(foundRes<1){if(uiHelper=='pandora'){tab.append("<div style='margin-top: -165px;'>No results found.</div>");kleissner.frontendChanges.toggleHeatmapStats(false);kleissner.frontendChanges.toggleDownloadSorter(false);}else if(!uiHelper){var msg='No results found.';if(!!GET_URL_PARAMETER("b")||!!GET_URL_PARAMETER("df")||!!GET_URL_PARAMETER("dt")||!!GET_URL_PARAMETER("m")&&GET_URL_PARAMETER("m")!=0){msg+=' <a href="?s='+encodeURIComponent(searchTerm)+'">Maybe try without filters?</a>';}
if(!!altterm&&!!alttermh){msg+=' <a href="?s='+encodeURIComponent(altterm)+'">Search instead for '+alttermh+'?</a>';}
kleissner.frontendChanges.changeSearchMessage(msg,0);kleissner.frontendChanges.toggleDownload(false);}}else if(foundRes>=1){if(uiHelper=='pandora'){tab.append("<div "+
"style='position: relative;width: 100%;text-align: center;height: 20px;z-index: -1;' "+
">"+
"No more results found."+
"</div>");}else if(!uiHelper){var msg='No more results found.';if(!!GET_URL_PARAMETER("b")||!!GET_URL_PARAMETER("df")||!!GET_URL_PARAMETER("dt")||!!GET_URL_PARAMETER("m")&&GET_URL_PARAMETER("m")!=0){msg+=' <a href="?s='+encodeURIComponent(searchTerm)+'">Maybe try without filters?</a>';}
if(!!altterm&&!!alttermh){msg+=' <a href="?s='+encodeURIComponent(altterm)+'">Search instead for '+alttermh+'?</a>';}
kleissner.frontendChanges.changeSearchMessage(msg,80);isSearching=false;}
if(uiHelper=='pandora'){kleissner.frontendChanges.toggleDownloadSorter(true);}else if(!uiHelper){kleissner.frontendChanges.toggleDownload(true);}}
search2.data("requestRunning",false);if(uiHelper=='pandora'){kleissner.frontendChanges.toggleSpinner(false);$("#showMore").hide();}else if(!uiHelper){$("#spinner").hide();}
return;}
if(!!data['records']&&data["records"].length<limit&&data["records"].length>0){setTimeout(function(){limit=limit-data["records"].length;checkResults(pl_ID,searchTerm,limit,groupUp,altterm,alttermh,0,null,null,null,null,reset);},2000);}else{if(data.length===0){if(foundRes<1){if(uiHelper=='pandora'){tab.append("<div style='margin-top: -165px;'>No results found.</div>");kleissner.frontendChanges.toggleDownloadSorter(false);}else if(!uiHelper){kleissner.frontendChanges.changeSearchMessage('No results found',0);kleissner.frontendChanges.toggleDownload(false);}}}else{if(uiHelper=='pandora'){kleissner.frontendChanges.toggleDownloadSorter(true);}else if(!uiHelper){kleissner.frontendChanges.toggleDownload(true);}}
search2.data("requestRunning",false);if(uiHelper=='pandora'){var anchor=$("#showMore").closest(".div");if(anchor.prevObject["0"]){anchor.prevObject["0"].remove();}
kleissner.frontendChanges.toggleSpinner(false);}else if(!uiHelper){$("#spinner").hide();}}}
initialSearch=false;}},kleissner.frontendChanges.onResultsError(pl_ID));}};getDetails=function getDetails(function_type,data_id,data_sid,data_tab,searchTerm,data_type,selector_type,data_size,data_bucket,e,data_friend,data_randomid,data_media){var element=$(this);var id=data_id;var sid=data_sid;var tab=data_tab;var stype=selector_type;var overflow,maxHeight,type;element.addClass("opened");var appendX="#d_"+data_randomid;if(!!data_friend){appendX="#d_"+data_friend;}
if(!function_type){overflow="hidden";maxHeight=SETTING_PREVIEW_LINES*20+"px";}else{overflow="auto";maxHeight="auto";}
if(data_type==2){type=3;}else if(data_type!=1&&data_type!=2){type=4;}else{type=2;}
var previewCommand;if(!function_type){if(data_media!=30){var f=type==3?1:0;previewCommand=API_URL+"file/preview?sid="+id+
"&f="+f+
"&l="+SETTING_PREVIEW_LINES+
"&c="+data_type+
"&m="+data_media+
"&b="+data_bucket+
"&k="+API_KEY;}else{previewCommand=API_URL+'file/view?f=12&storageid='+id+'&bucket='+data_bucket+'&k='+API_KEY+'&license='+API_LEVEL;}}else{previewCommand=API_URL+"file/view?f=0&storageid="+id+"&bucket="+data_bucket+"&k="+API_KEY;}
if(!function_type&&type==3){setTimeout(function(){var imgSrc='<img '+
'src="'+previewCommand+'" '+
'style="max-height: '+maxHeight+';"'+
'>';$(appendX).html("").prepend('<pre '+
'class="pre-details" '+
'style="'+
'border: 0;'+
'outline: none;'+
'height: '+SETTING_PREVIEW_LINES*20+"px;"+
'overflow-y: '+overflow+';'+
'overflow-x: hidden;'+
'"'+
'>'+
imgSrc+
'</pre>');var fullImage='<div class="full_data">'+
'<a href="https://intelx.io/?did='+sid+'" target="_blank" data-id="'+sid+'" class="view_details">Full Image</a>'+
'</div>';$(appendX).prepend(fullImage);},10);}else{$.get(previewCommand,function(data,textStatus,xhr){if(!!data){srcStr=data;if(type!=3){var lineHeight='height: '+SETTING_PREVIEW_LINES*20+'px;'
if(data_media==30){lineHeight='min-height: '+SETTING_PREVIEW_LINES*20+'px;'+'max-height: '+SETTING_PREVIEW_LINES*40+'px;'}
$(appendX).html("").prepend('<pre '+
'class="pre-details '+(data_media==30?"tree":"")+'" '+
'style="'+
'border: 0px;'+
'outline: none;'+
lineHeight+
'overflow-y: '+overflow+';'+
'overflow-x: hidden;'+
'"'+
'>'+
srcStr+
'</pre>');if(data_media==30){$(appendX).css('overflow','auto').find('.pre-details').css({'overflow-x':'auto','overflow-y':'auto'});}}
if(!function_type&&xhr.getResponseHeader("content-type")!='text/plain'&&data_media!=30){var fullData='<div class="full_data">'+
'<a href="https://intelx.io/?did='+sid+'" target="_blank" data-id="'+sid+'" class="d-none d-md-block view_details">Full Data</a>'+
'</div>';$(appendX).prepend(fullData);}}}).fail(function(xhr,status,error){if(!uiHelper&&(xhr.status=="401"||xhr.status=="402")){if(xhr.status=="401"){xhr.responseText=TEXT_401;$(appendX).html("").prepend('<pre class="pre-details" style="border: 0px;outline: none;height: '+SETTING_PREVIEW_LINES*20+'px;">'+
xhr.responseText+
"</pre>");}else if(xhr.status=="402"){xhr.responseText=TEXT_402;$(appendX).html("").prepend('<pre class="pre-details" style="border: 0px;outline: none;height: '+SETTING_PREVIEW_LINES*20+'px;">'+
xhr.responseText+
"</pre>");}}else{if(data_type>=1000){xhr.responseText="No data";$(appendX).hide();$("#meta_"+sid).show();$(".meta_details[data-sid="+sid+"]").hide().toggleClass("fa-plus-square-o fa-minus-square-o");}
$(appendX).html("").prepend('<pre '+
'class="pre-details" '+
'style="border: 0px;outline: none;height: '+SETTING_PREVIEW_LINES*20+'px;"'+
'>'+
xhr.responseText+
'</pre>');}});}};getSearchId=function getSearchId(formData,searchTerm,lookuplevel,type,callback){initialSearch=true;$('#adv_search').hide();$('#softselectorbutton').remove();var buckets=formData.targetservice;var date_from,date_to,start_time;if(!searchTerm){return;}
$('#found_media_stats').html('');if(!uiHelper){kleissner.localHandler.openChartModalOnClick(true);$('#heatmapContainer').parent().attr('data-date',null);}
if(!type){type=formData.Types;}
if(!!formData.date_from&&!!formData.date_to){date_from=formData.date_from+" 00:00:00";date_to=formData.date_to+" 23:59:59";}else{date_from="";date_to="";}
var checkPhonebook=formData.checkPhonebook=='on';var checkGroup=Number(formData.checkGroup=='on');formData={term:searchTerm,buckets:buckets,lookuplevel:lookuplevel,maxresults:Number(SETTING_MAX_RESULT),timeout:Number(formData.timeout),datefrom:date_from,dateto:date_to,sort:uiHelper=='pandora'?Number($("#main_sorting").val()):Number(formData.sort_order),media:Number(formData.mediaFilter),terminate:!uiHelper?lastSearchIDs:null};search2.data("requestRunning",true);start_time=new Date().getTime();if(uiHelper=='pandora'){kleissner.frontendChanges.toggleSpinner(true);kleissner.frontendChanges.toggleHeatmapStats(false);}else if(!uiHelper){$("#spinner").show();kleissner.frontendChanges.hideWarnings();kleissner.frontendChanges.toggleHeader(false);}
lastSearchIDs=[];searchAPIPost("intelligent/search",JSON.stringify(formData),function(p,statusText,xhr){if(!uiHelper){if(p.status=="1"){$('#invalidtermwarning').show();kleissner.frontendChanges.toggleSearch(true);$('#spinner').hide();return;}else if(p.status=="2"){$('#limitsearchwarning').show();kleissner.frontendChanges.toggleSearch(true);$('#spinner').hide();return;}
if(!!p.softselectorwarning){$('#softselectorwarning').show();if(!checkPhonebook){$('#softselectorwarning').children('.alert').children('div').append('<button id="softselectorbutton" class="btn btn-primary"><i class="fa fa-magic"></i> Search Phonebook</button>');}}}
kleissner.frontendChanges.toggleSearch(true);limit=uiHelper!='intelxIframe.io'?10:20;foundRes=0;lastSearchIDs.push(p.id);currentSearchId=p.id;monthNamesUsed=[];if(uiHelper=='pandora'){try{cal.rewind();}catch(err){}}
setTimeout(function(){checkResults(p.id,searchTerm,limit,checkGroup,p.altterm,p.alttermh,1,null,null,null,null,null,callback);if(uiHelper=='pandora'){kleissner.localApiCalls.checkStats(p.id);if(!SETTING_HEATMAP){$("#cal-heatmap").html("").hide();}}
$("#export_wrapper").show();var allHref=API_URL+
"intelligent/search/export?id="+p.id+
"&f=0"+
"&l="+Number(SETTING_EXPORT_LIMIT)+
"&k="+API_KEY;$("#download_all").attr("href",allHref);var allZipHref=API_URL+
"intelligent/search/export?id="+p.id+
"&f=1"+
"&l="+Number(SETTING_EXPORT_LIMIT)+
"&k="+API_KEY;$("#download_all_zip").attr("href",allZipHref);},Number(SETTING_SPLASH_TIME));},!uiHelper?function(xhr,status,error){kleissner.frontendChanges.toggleSearch(true);if(xhr.status=="402"){if(API_LEVEL.indexOf("public")!=-1){$('#creditsModal').modal({backdrop:'static',keyboard:false});$('#spinner').hide();}else{$('#paymentModal').modal({backdrop:'static',keyboard:false});$('#spinner').hide();}}else if(xhr.status=="401"){kleissner.frontendChanges.appendSearchError('Error: Not authorized. [401]\nYour account does not have access to the requested data.');}else if(xhr.status=="400"){kleissner.frontendChanges.appendSearchError('Error: Invalid JSON sent from API. [400]');}else if(xhr.status=="403"){kleissner.frontendChanges.appendSearchError('Access denied. Your IP is blacklisted. If you are using Tor, <a href="https://blog.intelx.io/2020/07/05/why-we-are-going-to-block-tor-ips/">read this</a>.');}else{kleissner.frontendChanges.appendSearchError('Error: Could not contact API. [failed]');}}:null);};getAuthenticateInfo=function getAuthenticateInfo(){searchAPIGet('authenticate/info',[],function(data,textStatus,xhr){var addLicenceDetails=function(title,rows)
{$('#licenceDetails > table > tbody:last-child').append('<tr><th colspan="2">'+title+':</th></tr>');if(rows.length){$.each(rows,function(k,t){$('#licenceDetails > table > tbody:last-child').append('<tr><td></td><td>'+t+'</td></tr>');});}else{$('#licenceDetails > table > tbody:last-child').append('<tr><td></td><td>N/A</td></tr>');}}
addLicenceDetails('Buckets',data.bucketsh);addLicenceDetails('Preview',data.previewh);$('#licenceDetails > table > tbody:last-child').append('<tr><td colspan="2">'+data.searchesactive+' of '+data.maxconcurrentsearches+' concurrent searches active</td></tr>');var isEmptyCreditTable=true;$.each(data.paths,function(k,path){if(path.CreditReset>0){$('#creditInfo > table > tbody:last-child').append('<tr><th>'+path.Path+'</th><td>'+path.Credit+' of '+path.CreditMax+' left</td></tr>');isEmptyCreditTable=false;}else{$('#creditInfo > table > tbody:last-child').append('<tr><th>'+path.Path+'</th><td> (no limit)</td></tr>');isEmptyCreditTable=false;}});if(isEmptyCreditTable){$('#creditInfo > table > tbody:last-child').append('<tr><th colspan="2">N/A</td></tr>');}
$('#creditInfo > table > tbody > tr:last-child').attr('class','last');$('#licenseTable > table > tbody > tr:last-child').attr('class','last');$('#licenceDetails > table > tbody > tr:last-child').attr('class','last');$('#licenceDetails').show();$('#creditInfo').show();},function(){return false;});};init=function(){};$(document).ready(init);return{searchAPIGet:searchAPIGet,searchAPIPost:searchAPIPost,getSearchIdPB:getSearchIdPB,getSelectorList:getSelectorList,getViewDetails:getViewDetails,loadRawData:loadRawData,checkResults:checkResults,getDetails:getDetails,getSearchId:getSearchId,getAuthenticateInfo:getAuthenticateInfo,}}($));'use strict';var kleissner=kleissner||{};kleissner.eventHandler=(function($){const uiHelper=typeof uiToolkitType!=='undefined'?uiToolkitType:false;var
dataSearchOnKeyUp,detailedViewOnScroll,onEnter,onInlineSearchPB,closeDetailOnClick,dataTabOnClick,detailOverlayOnClick,findOnClick,h4TooltipOnMouseEnter,h4TooltipOnMouseLeave,selectorTrOnMouseEnter,showExpertOnClick,selectorSearchOnEnter,selectorSearchOnKeyUp,softselectorBtnOnClick,viewDetailsOnClick,advancedBtnOnClick,advancedCatOnClick,advRemoveOnClick,checkPhonebookOnClick,checkGroupOnClick,clearOnClick,filtersOnClick,mediaFilterOnChange,onInlineSearch,searchBtnOnClick,sortOnClick,termOnBlur,termOnFocus,advFilterTextClick,init;dataSearchOnKeyUp=function dataSearchOnKeyUp(event){var obj=$(this);var id=event.data.id;detailsSearchValue[id]=$(this).val();if(!$.isNumeric(detailsSearchIndex[id])){detailsSearchIndex[id]=0;}
if(!$.isNumeric(detailsSearchSubIndex[id])){detailsSearchSubIndex[id]=0;}
var total=0;if(!!detailsSearchValue[id]){detailsSearchArr[id]=[];var k=0;for(var i=0;i<detailsData[id].length;i++){var j=0;while(j<detailsData[id][i].length){j=detailsData[id][i].toLowerCase().indexOf(detailsSearchValue[id].toLowerCase(),j);if(j>=0){if(!detailsSearchArr[id][k]){detailsSearchArr[id][k]={index:i,positions:[]};}
detailsSearchArr[id][k].positions.push(j);total++;j+=detailsSearchValue[id].length;}else if(j==-1){k=detailsSearchArr[id].length;break;}}}
if(total>0){$('#searchResults').html('1 of '+total);}else{$('#searchResults').html('Not Found');}}else{$('#searchResults').html('');detailsSearchArr[id]=[];}
if(event.keyCode==13&&detailsSearchArr[id].length>0){var count=1;for(var i=0;i<detailsSearchIndex[id];i++){count+=detailsSearchArr[id][i].positions.length;}
detailsSearchSubIndex[id]++;count+=detailsSearchSubIndex[id];if(count>total){count=1;}
$('#searchResults').html(count+' of '+total);if(typeof detailsSearchArr[id][detailsSearchIndex[id]]==='undefined'||detailsSearchSubIndex[id]>=detailsSearchArr[id][detailsSearchIndex[id]].positions.length){detailsSearchSubIndex[id]=0;detailsSearchIndex[id]++;if(detailsSearchIndex[id]>=detailsSearchArr[id].length){detailsSearchIndex[id]=0;}}}else{detailsSearchIndex[id]=0;detailsSearchSubIndex[id]=0;}
clearTimeout($.data(this,'searchTimer'));$.data(this,'searchTimer',setTimeout(function(){var next=obj.parent().next();var afterScrollY=function afterScrollY(){var selected=next.find('.selected.highlighted');var offset=selected.offset();var width=next.width();var multiplier=1;if(!!offset){while(width*multiplier<selected.offset().left-selected.parent().offset().left+selected.width()){multiplier+=1;}
next.scrollLeft(width*(multiplier-1));}else{next.scrollLeft(0);}};if(detailsSearchArr[id].length>0){next.animate({scrollTop:typeof detailsSearchArr[id][detailsSearchIndex[id]]==='undefined'?0:detailsSearchArr[id][detailsSearchIndex[id]].index*20},0);kleissner.eventHandler.detailedViewOnScroll(event,afterScrollY);}else{$('.detailLine > .selected').contents().unwrap();}},50));};detailedViewOnScroll=function detailedViewOnScroll(event,callback){clearTimeout($.data(this,'scrollTimer'));$.data(this,'scrollTimer',setTimeout(function(){var id=event.data.id;$('#data_full > div').html(showDataInView('#data_full',detailsData[id],20,detailsSearchArr[id],detailsSearchIndex[id],detailsSearchSubIndex[id],detailsSearchValue[id]));if(typeof callback==='function'){callback();}},50));};onEnter=function onEnter(event){if(event.keyCode==13&&$('#Term').is(':focus')===true){event.preventDefault();$('#btnSearch').trigger('click');}};onInlineSearchPB=function onInlineSearchPB(e){var end=uiHelper=='pandora'?'PB':'';$("#Term"+end).val(e);var formData=$("#searchData"+end).serializeJSON();kleissner.frontendChanges.onSearch();kleissner.apiCalls.getSearchIdPB(formData,formData['Term'+end]);$("#tabPB").html("");$("#services_container").hide();$(".tooltip").remove();if(!uiHelper){if(!!formData&&!!formData['Term'+end]){kleissner.apiCalls.getSearchId(formData,formData['Term'+end],0);}else{kleissner.frontendChanges.onSearchEnd();}}};closeDetailOnClick=function closeDetailOnClick(){$('#detail_overlay').modal('hide');$('#data_full').off('scroll').html('');$('#dataFullSearch').off('keyup').val('');$('#expertTitle').hide();$('#tech_data').hide();$('#showExpert').show();$('#declassDiv').hide();$('#searchResults').html('');var sID=$('#close-detail-view').attr('data-storageid');delete detailsData[sID];detailsPrint=[];delete detailsSearchArr[sID];delete detailsSearchIndex[sID];delete detailsSearchSubIndex[sID];delete detailsSearchValue[sID];if(!!xhr){xhr.abort();}};dataTabOnClick=function dataTabOnClick(event){$('.data_tab').removeClass('active');$(this).addClass('active');$('.data_content').hide();$('#'+$(this).attr('data-tab')).css('display','inherit');};detailOverlayOnClick=function detailOverlayOnClick(event){if(event.target===this){$('#close-detail-view').click();}};findOnClick=function findOnClick(event){event.preventDefault();event.stopPropagation();$(this).next("ul").toggle();};h4TooltipOnMouseEnter=function h4TooltipOnMouseEnter(event){var obj=$(this);if(this.offsetWidth<this.scrollWidth&&!obj.attr("title")){obj.attr("data-original-title",obj.text());obj.attr("data-toggle","tooltip");obj.attr("data-placement","top");obj.attr("tooltip-append-to-body","");$("#tooltip").show();$(this).tooltip("show");}};h4TooltipOnMouseLeave=function h4TooltipOnMouseLeave(event){$(this).tooltip("hide");};selectorSearchOnEnter=function selectorSearchOnEnter(event){if(event.keyCode==13){event.preventDefault();}};selectorSearchOnKeyUp=function selectorSearchOnKeyUp(event){var searchTerm=$(this).val();var searchSplit=searchTerm.replace(/ /g,"'):containsi('");$.extend($.expr[":"],{containsi:function(elem,i,match,array){return((elem.textContent||elem.innerText||"").toLowerCase().indexOf((match[3]||"").toLowerCase())>=0);}});var obj=$(".results tbody tr");obj.not(":containsi('"+searchSplit+"')").each(function(e){$(this).attr("visible","false").hide();});$(".results tbody tr:containsi('"+searchSplit+"')").each(function(e){$(this).attr("visible","true").show();});var visibleCount=$('.results tbody tr[visible="true"]').length;var totalCount=obj.length;var total_visible="Showing "+visibleCount+" out of "+totalCount+" Total";$(".counter").text(total_visible);};selectorTrOnMouseEnter=function selectorTrOnMouseEnter(){$('.selectorSearch').remove();var td=$(this).find('td').first();td.append(' <a href="./?s='+td.html().trim()+'" target="_blank" class="selectorSearch" data-placement="right" data-toggle="tooltip" title="Search for Selector"><i class="fa fa-external-link"></i></a>');};showExpertOnClick=function showExpertOnClick(event){event.preventDefault();$('#expertTitle').show();$('#tech_data').show();$(this).hide();};softselectorBtnOnClick=function softselectorBtnOnClick(){$('#checkPhonebook').click();$('#btnSearch').click();};viewDetailsOnClick=function viewDetailsOnClick(id){$("#detail_overlay").css("display","none");$("#data_full").html('<div style="text-align: center;margin-top: 250px;">Loading Data ...</div>');window.onpopstate=function(){kleissner.eventHandler.closeDetailOnClick();window.onpopstate=onPopState;};window.history.pushState({page:'index',form:window.history.state.form,viewID:id,tabs:$('#tab_row').html()},null,'./?did='+id);currentHistoryIndex=window.history.length;$('#inline_sel_id_overlay').find('.sel_id_table').addClass('empty').bootstrapTable("load",{data:[]});$('.data_tab[data-tab="data_full_tab"]').click();kleissner.apiCalls.getViewDetails(id);};advancedBtnOnClick=function advancedBtnOnClick(event){event.preventDefault();$("#adv_search").toggle();};advancedCatOnClick=function advancedCatOnClick(event){$('.adv_cats').removeClass('active');$(this).addClass('active');$('.adv_tabs').hide();$('#'+$(this).attr('data-tab')).css('display','inherit');};advRemoveOnClick=function advRemoveOnClick(event){var parent=$(this).parent();if(parent.attr('id')=='date_range'){$('#date_from').data('DateTimePicker').date(null);$('#date_to').data('DateTimePicker').date(null);}else if(parent.attr('id')=='media_label'){$('#mediaFilter').val(0);}else{console.log('#'+parent.attr('data-remove'));console.log($('#'+parent.attr('data-remove')));$('#'+parent.attr('data-remove')).prop('checked',false);}
parent.remove();};checkPhonebookOnClick=function checkPhonebookOnClick(event){if($(this).prop('checked')){$('#adv_settings > div').append(AdvFilterHTML("phonebook_label","checkPhonebook","adv_misc","Search Phonebook"));}else{$('#phonebook_label').remove();}};checkGroupOnClick=function checkGroupOnClick(event){if($(this).prop('checked')){$('#adv_settings > div').append(AdvFilterHTML("group_label","checkGroup","adv_misc","Group Similar Results"));}else{$('#group_label').remove();}};clearOnClick=function clearOnClick(event){event.preventDefault();if(!!$('#date_from').data('DateTimePicker')){$('#date_from').data('DateTimePicker').date(null);$('#date_to').data('DateTimePicker').date(null);}
$('input[name="targetservice[]"]').prop('checked',false);$('input[name="sort_order"][value="2"]').prop('checked','checked');$('input[name="pb_target"][value="0"]').prop('checked','checked');$('#mediaFilter').val(0);$('#checkPhonebook').prop('checked',false);$('.adv_filter:not([id="sort_label"]):not([id="media_label"])').remove();$('#sort_label .adv_filter_text').html('Sorted by Most Relevant');$('#media_label').hide();$('#checkGroup').prop('checked',false);};filtersOnClick=function filtersOnClick(event){var id=$(this).attr('id');if($(this).prop('checked')){var text=$('label[for="'+id+'"]').html();$('#adv_filters > div').append(AdvFilterHTML(null,id,"adv_categories",text));}else{$('.adv_filter[data-remove="'+id+'"]').remove();}};mediaFilterOnChange=function mediaFilterOnChange(event){$('#media_label').remove();if($(this).val()!="0"){$('#adv_settings > div').append(AdvFilterHTML("media_label","mediaFilter","adv_misc",'Media Filter: '+$(this).find("option:selected").text()));}};onInlineSearch=function onInlineSearch(e,lookuplevel){$("#Term").val(e);var formData=$("#searchData").serializeJSON();kleissner.apiCalls.getSearchId(!!formData?formData:{},e,lookuplevel,[0]);kleissner.frontendChanges.toggleSearch(false);$(".tooltip").remove();kleissner.frontendChanges.toggleHeader(false);$("#main_search_0").removeClass("col-sm-3 col-md-3 col-lg-3 col-xl-4").addClass("");};searchBtnOnClick=function searchBtnOnClick(event){event.preventDefault();if(!uiHelper){searchResArr=[];}
var formData=$('#searchData').serializeJSON();if(!formData['Term']){kleissner.frontendChanges.onSearchError();return;}
aborted=false;kleissner.frontendChanges.onSearch();if(!uiHelper){$('#indexAd').hide();if(typeof typer!=="undefined"){typer.stop();}
$('#services_container').hide();if(!!formData.checkPhonebook){kleissner.apiCalls.getSearchIdPB(formData,formData['Term']);}}
kleissner.apiCalls.getSearchId(!!formData?formData:{},formData['Term'],0,null);var helper='s='+encodeURIComponent(formData['Term']);if(!!formData['targetservice']&&formData['targetservice'].length>0){helper+='&b='+formData['targetservice'][0];for(var i=1;i<formData['targetservice'].length;i++){helper+=','+formData['targetservice'][i];}}
helper+=formData['date_from']?'&df='+formData['date_from']:'';helper+=formData['date_to']?'&dt='+formData['date_to']:'';if(formData['mediaFilter']!=0){helper+=formData['mediaFilter']?'&m='+formData['mediaFilter']:'';}
if(formData['sort_order']!=2){helper+=formData['sort_order']?'&so='+formData['sort_order']:'';}
if(formData['checkPhonebook']){helper+='&pb=1';}
if(formData['checkGroup']){helper+='&g=1';}
if(uiHelper=='pandora'){if(terms==undefined){terms=[];terms[pl_ID]=formData;window.history.pushState({page:'index',form:formData,terms:terms},null,'./?'+helper);}else{terms[pl_ID]=formData;window.history.replaceState({page:'index',form:formData,terms:terms},null,'./?'+helper);}}else{window.history.pushState({page:'index',form:formData},null,'./?'+helper);}
kleissner.frontendChanges.onSearchEnd();};sortOnClick=function sortOnClick(event){$('#sort_label .adv_filter_text').html('Sorted by '+$('label[for="'+$(this).attr('id')+'"]').html());};termOnBlur=function termOnBlur(event){$(this).parent("div").css("box-shadow","");};termOnFocus=function termOnFocus(event){$(this).parent("div").css("box-shadow","0 3px 8px 0 rgba(0,0,0,0.2), 0 0 0 1px rgba(0,0,0,0.08)");};advFilterTextClick=function advFilterTextClick(event){$('.adv_cats').removeClass('active');$('.adv_tabs').hide();$('#'+$(this).parent('.adv_filter').attr('data-tab')).css('display','inherit');$('.adv_cats[data-tab='+$(this).parent('.adv_filter').attr('data-tab')+']').addClass('active');};init=function init(){$(document).on('keypress',onEnter);$(document).on('click','.blankInlineSearchPB',function(event){event.preventDefault();window.open("./?s="+$(this).attr('data-to-search'));});$(document).on('click','.data_tab',dataTabOnClick);$(document).on('click','#detail_overlay',detailOverlayOnClick);$(document).on('click','.dropdown-submenu a.test',findOnClick);$(document).on('mouseenter','.h4_tooltip',h4TooltipOnMouseEnter);$(document).on('mouseleave','.h4_tooltip',h4TooltipOnMouseLeave);$(document).on('keydown',".selector_search",selectorSearchOnEnter);$(document).on('keyup','.selector_search',selectorSearchOnKeyUp);$(document).on('mouseenter','.sel_id_table:not(.empty) tbody tr, .toolsSelectorTable:not(.empty) tbody tr',selectorTrOnMouseEnter);$(document).on('click','#showExpert',showExpertOnClick);$(document).on('click','#softselectorbutton',softselectorBtnOnClick);$(document).on('click','.view_details',function(event){event.preventDefault();viewDetailsOnClick($(this).attr('data-id'));});$(document).on('click','#adv_search_button, #adv_search_buttonSmall, #adv_search_button_close',advancedBtnOnClick);$(document).on('click','.adv_cats',advancedCatOnClick);$(document).on('click','.adv_remove',advRemoveOnClick);$(document).on('click','#checkPhonebook',checkPhonebookOnClick);$(document).on('click','#checkGroup',checkGroupOnClick);$(document).on('click','#clear_filters',clearOnClick);$(document).on('click','input[name="targetservice[]"]',filtersOnClick);$(document).on('change','#mediaFilter',mediaFilterOnChange);$(document).on('click','#btnSearch',searchBtnOnClick);$(document).on('click','input[name="sort_order"]',sortOnClick);$(document).on('blur','#Term',termOnBlur);$(document).on('focus','#Term',termOnFocus);$(document).on('click','.adv_filter_text',advFilterTextClick);};$(document).ready(init);return{dataSearchOnKeyUp:dataSearchOnKeyUp,detailedViewOnScroll:detailedViewOnScroll,onInlineSearchPB:onInlineSearchPB,closeDetailOnClick:closeDetailOnClick,viewDetailsOnClick:viewDetailsOnClick,onInlineSearch:onInlineSearch}}($));